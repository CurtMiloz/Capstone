var map,table_coords,table_refs,length,width,mapFile,drinkArr,numTanks,errList=[],square_size=100,editTables=!1,mapModified=!1,mapSyms=["0","X","T","H"];function getAndSetDrinks(){devMode?(drinksArr={coke:"1",pepsi:"3"},numTanks=3,updateDrinksList()):NetworkCall("get_num_tanks")}function tankFilled(e){var t=Object.entries(drinksArr);for(x in t)if(e==t[x][1])return!0;return!1}function getIndex(e){var t=Object.entries(drinksArr);for(x in t)if(e==t[x][1])return x;return!1}function updateDrinksList(){var e=document.getElementById("drinkList");$(e).html("");for(var t=0,n=Object.entries(drinksArr),r=1;r<numTanks+1;r++)tankFilled(r)?(t=getIndex(r),$(e).append('<div class="input-group mb-3 my-3 w-50"><div class="input-group-prepend w-50"><span class="input-group-text w-100"> Nozzle '+r+': </span></div><input readonly class="form-control" type="text" value= '+n[t][0]+" ><div class=\"input-group-append\"><div class='btn btn-danger' onclick='removeDrink(\""+n[t][0]+"\");'>Remove</div></div></div>")):$(e).append('<div class="input-group mb-3 my-3 w-50"><div class="input-group-prepend w-50"><span class="input-group-text w-100"> Nozzle '+r+': </span></div><input class="form-control" placeholder="NOT SET" id="nozzle'+r+'" type="text"><div class="input-group-append"><div class=\'btn btn-success\' onclick=\'addDrink('+r+");'>Apply</div></div></div>")}function addDrink(e){elem=document.getElementById("nozzle"+e);var t={};t[elem.value]=e,NetworkCall("add_drink",t)}function removeDrink(e){NetworkCall("remove_drink",e)}function changeDimensions(){templength=parseInt(document.getElementById("len").value),tempwidth=parseInt(document.getElementById("wid").value),isNaN(templength)||(length=templength),isNaN(tempwidth)||(width=tempwidth),makeMap(),updateMap()}function makeMap(){for(var e=0;e<length;e++){map.push([]);for(var t=0;t<width;t++)map[e].push("0")}map[0][0]="H",table_coords=[]}function parseFiles(){if(void 0===mapFile){var e=!1;console.log("mapFile is undefined")}else{e=!0;console.log("mapFile is DEFINED")}if(map=[],e)try{lines=mapFile.split("\n"),temp=lines[0],length=temp.split(",")[0],width=temp.split(",")[1];for(var t=1;t<length+1;t++){map.push([]),temp=lines[t].split(",");for(var n=0;n<width;n++)map[t-1].push(temp[n])}table_coords=[]}catch(e){console.log(e.message)}else{width=length=10;for(t=0;t<length;t++){map.push([]);for(n=0;n<width;n++)map[t].push("0")}map[0][0]="H",table_coords=[]}}function save(){mapFile=length+","+width+"\n";for(var e=0;e<length;e++){map.push([]);for(var t=0;t<width;t++)t==width-1?mapFile+=map[e][t]:mapFile=mapFile+map[e][t]+",";e!=length-1&&(mapFile+="\n")}devMode?console.log(mapFile):NetworkCall("save_map")}function onClickChange(e,t){console.log("merp i = "+e+", j = "+t),editTables||(mapModified=!0,console.log(map),map[e][t]=mapSyms[(mapSyms.indexOf(map[e][t])+1)%4],console.log(map),updateMap())}function updateMap(){var e="";table_coords=[],table_refs=[],count_tblRef=0;var t=100;newWidth=String(100*width)+"px",newLength=String(100*length)+"px",doc=document.getElementById("mapmaker"),board=document.getElementById("board"),board&&board.parentNode.removeChild(board),e="<div id='board' class='board mt-2 px-auto' style='width:"+newWidth+"; height:"+newLength+";' >";for(var n=0;n<length;n++){for(var r=0,a=0;a<width;a++){var o="";if(a==width-1)var s="<div class='d-block' style =  \" display:block; float:left;    left:"+r+"px; top:"+t+'px;"';else s="<div class='d-inline' style =  \" float:left;    left:"+r+"px; top:"+t+'px;"';var i="";"0"==map[n][a]?i=' onclick = "onClickChange('+n+","+a+')" id = "clear"':"X"==map[n][a]?i=' onclick = "onClickChange('+n+","+a+')" id = "blocked"':"T"==map[n][a]?(i=' onclick = "onClickChange('+n+","+a+')" id = "table"',o="Table",table_refs.push(count_tblRef),table_coords.push([n,a]),count_tblRef+=1):"H"==map[n][a]&&(i=' onclick = "onClickChange('+n+","+a+')" id = "base"',o="Home"),e+=s=s+i+">"+o+"</div>",r+=square_size}e+="",t+=square_size}e+="</div>",$(doc).append(e)}function load(){NetworkCall("load_map")}function setErrorList(e){var t=e;errList=[],1==(t&&1)&&("LowLiquid <br>",errList.push("Low Liquid")),16==(t&&16)&&("LeakingTank <br>",errList.push("Leaking Tank")),256==(t&&256)&&("LowBattery <br>",errList.push("Low Battery")),4096==(t&&4096)&&("NoMovement <br>",errList.push("No Movement")),renderErrors()}function renderErrors(){var e=document.getElementById("errorContainer");for(x in $(e).html(""),errList){var t=errList[x];$(e).append('<div class="row text-center ml-5 w-25 "><div class="card card-body text-center text-white bg-danger o-hidden h-100 w-25">'+t+"</div></div><br>"),console.log(e)}}function createCORSRequest(e,t){var n=new XMLHttpRequest;return"withCredentials"in n?n.open(e,t,!0):"undefined"!=typeof XDomainRequest?(n=new XDomainRequest).open(e,t):n=null,n}function Login(){devMode?navigate("../errors.html"):(form=document.getElementById("loginForm"),userid=form.user.value,passwd=form.pass.value,NetworkCall("login",[userid,passwd]))}function Logout(){NetworkCall("logout")}function navigate(e){window.location.href=e}function NetworkCall(e,t){if("login"==e){if(!(a=createCORSRequest("POST","/proxy/login")))throw new Error("CORS not supported");var n=String(t[0])+":"+String(t[1]),r=btoa(n);a.setRequestHeader("Authorization","Basic "+r),a.onreadystatechange=function(){200==a.status&&4==a.readyState?navigate("../errors.html"):console.log("Error: "+a.responseText)},a.send()}else if("logout"==e){if(!(a=createCORSRequest("POST","/proxy/logout")))throw new Error("CORS not supported");a.onreadystatechange=function(){200==a.status&&4==a.readyState?navigate("../login.html"):console.log("Error: "+a.responseText)},a.send()}else if("getErrors"==e){if(!(a=createCORSRequest("GET","/proxy/errors")))throw new Error("CORS not supported");a.onreadystatechange=function(){200==a.status&&4==a.readyState?setErrorList(a.responseText):401==a.status?navigate("../index.html"):console.log("Error: "+a.responseText)},a.send()}else if("call_home"==e){if(!(a=createCORSRequest("GET","/proxy/returnToBase")))throw new Error("CORS not supported");a.onreadystatechange=function(){200==a.status&&4==a.readyState?alert("alfred is on the way home"):401==a.status?navigate("../index.html"):console.log("Error: "+a.responseText)},a.send()}else if("save_map"==e){if(!(a=createCORSRequest("POST","/proxy/map")))throw new Error("CORS not supported");a.onreadystatechange=function(){200==a.status&&4==a.readyState?(alert("uploaded to server"),mapModified=!1):401==a.status?navigate("../index.html"):console.log("Error: "+a.responseText)},a.send(mapFile)}else if("load_map"==e){if(!(a=createCORSRequest("GET","/proxy/map")))throw new Error("CORS not supported");a.send(),a.onreadystatechange=function(){200==a.status&&4==a.readyState?(mapFile=String(a.responseText),console.log(a.responseText),console.log(mapFile),parseFiles(),updateMap(),mapModified=!1):401==a.status?navigate("../index.html"):console.log("Error: "+a.responseText)}}else if("get_drinks"==e){if(!(a=createCORSRequest("GET","proxy/drinks")))throw new Error("CORS not supported");a.onreadystatechange=function(){4==a.readyState&&(200==a.status?(drinksArr=JSON.parse(a.responseText),console.log(drinksArr),updateDrinksList()):401==a.status?navigate("../index.html"):alert("error getting drink list"))},a.send()}else if("get_num_tanks"==e){if(!(a=createCORSRequest("GET","proxy/numOfTanks")))throw new Error("CORS not supported");a.onreadystatechange=function(){4==a.readyState&&(200==a.status?(numTanks=JSON.parse(a.responseText),NetworkCall("get_drinks")):401==a.status?navigate("../index.html"):alert("error getting number of tanks"))},a.send()}else if("add_drink"==e){if(!(a=createCORSRequest("POST","proxy/drinks")))throw new Error("CORS not supported");a.onreadystatechange=function(){4==a.readyState&&(200==a.status?(alert("added drink"),NetworkCall("get_drinks")):401==a.status?navigate("../index.html"):alert("error getting number of tanks"))},a.send(JSON.stringify(t))}else if("remove_drink"==e){var a;if(!(a=createCORSRequest("DELETE","proxy/drinks?name="+String(t))))throw new Error("CORS not supported");a.onreadystatechange=function(){4==a.readyState&&(200==a.status?(alert("removed drink"),NetworkCall("get_drinks")):401==a.status?navigate("../index.html"):alert("error getting number of tanks"))},a.send()}}devMode=!1,mapTEST="10,10\n3,0,0,0,0,0,0,0,0,0\n0,2,0,2,0,0,0,0,0,0\n0,0,0,1,0,0,0,0,0,0\n0,0,0,0,0,0,0,0,0,0\n0,0,0,0,0,0,0,0,0,0\n0,0,0,0,0,0,0,0,0,0\n0,0,0,0,0,0,0,0,0,0\n0,0,0,0,0,0,0,0,0,0\n0,0,0,0,0,0,0,0,0,0\n0,0,0,0,0,0,0,0,0,0",window.onload=function(){x=document.getElementById("lowLiquid"),path=document.location.pathname,"localhost"==document.location.hostname&&3e3==document.location.port?(devMode=!0,"/"==path||"/errors.html"==path?"localhost"==document.location.hostname&&3e3==document.location.port&&setErrorList(15):"/charts.html"==path?(parseFiles(),updateMap()):"/manageDrinks.html"==path&&getAndSetDrinks()):(devMode=!1,"/"==path||"/errors.html"==path?NetworkCall("getErrors"):"/charts.html"==path?(parseFiles(),updateMap()):"/manageDrinks.html"==path&&getAndSetDrinks())};