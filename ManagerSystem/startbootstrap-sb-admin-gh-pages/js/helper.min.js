var map,table_coords,table_refs,length,width,mapFile,errList=[],square_size=100,editTables=!1,mapModified=!1;function parseFiles(){if(void 0===mapFile)var e=!1;else e=!0;if(map=[],e)try{lines=mapFile.split("\n"),temp=lines[0],length=temp.split(",")[0],width=temp.split(",")[1];for(var t=1;t<length+1;t++){map.push([]),temp=lines[t].split(",");for(var o=0;o<width;o++)map[t-1].push(temp[o])}}catch(e){console.log(e.message)}else{width=length=10;for(t=0;t<length;t++){map.push([]);for(o=0;o<width;o++)map[t].push("0")}map[0][0]=3,table_coords=[]}}function save(){mapFile=length+","+width+"\n";for(var e=0;e<length;e++){map.push([]);for(var t=0;t<width;t++)t==width-1?mapFile+=map[e][t]:mapFile=mapFile+map[e][t]+",";e!=length-1&&(mapFile+="\n")}NetworkCall("save_map")}function onClickChange(e,t){console.log("merp i = "+e+", j = "+t),editTables||(mapModified=!0,map[e][t]=(map[e][t]+1)%4,updateMap())}function updateMap(){var e="";table_coords=[],table_refs=[];for(var t=100,o=count_tblRef=0;o<length;o++){for(var r=0,n=0;n<width;n++){var a="",s='<div style =  " display:block;float:left;    left:'+r+"px; top:"+t+'px;"',i="";"0"==map[o][n]?i=' onclick = "onClickChange('+o+","+n+')" id = "clear"':"1"==map[o][n]?i=' onclick = "onClickChange('+o+","+n+')" id = "blocked"':"2"==map[o][n]?(i=' onclick = "onClickChange('+o+","+n+')" id = "table"',a="Table",table_refs.push(count_tblRef),table_coords.push([o,n]),count_tblRef+=1):"3"==map[o][n]&&(i=' onclick = "onClickChange('+o+","+n+')" id = "base"',a="Home"),e+=s=s+i+">"+a+"</div>",r+=square_size}e+="<br>",t+=square_size}document.getElementById("board").innerHTML=e,console.log(document.getElementById("board"))}function load(){NetworkCall("load_map")}function setErrorList(e){var t=e;errList=[],1==(t&&1)&&("LowLiquid <br>",errList.push("Low Liquid")),16==(t&&16)&&("LeakingTank <br>",errList.push("Leaking Tank")),256==(t&&256)&&("LowBattery <br>",errList.push("Low Battery")),4096==(t&&4096)&&("NoMovement <br>",errList.push("No Movement")),renderErrors()}function renderErrors(){var e=document.getElementById("errorContainer");for(x in $(e).html(""),errList){var t=errList[x];$(e).append('<div class="row text-center ml-5 w-25 "><div class="card card-body text-center text-white bg-danger o-hidden h-100 w-25">'+t+"</div></div><br>"),console.log(e)}}function createCORSRequest(e,t){var o=new XMLHttpRequest;return"withCredentials"in o?o.open(e,t,!0):"undefined"!=typeof XDomainRequest?(o=new XDomainRequest).open(e,t):o=null,o}function Login(){form=document.getElementById("loginForm"),userid=form.user.value,passwd=form.pass.value,NetworkCall("login",[userid,passwd])}function Logout(){NetworkCall("logout")}function navigate(e){window.location.href=e}function NetworkCall(e,t){if("login"==e){if(!(n=createCORSRequest("POST","/proxy/login")))throw new Error("CORS not supported");var o=String(t[0])+":"+String(t[1]),r=btoa(o);n.setRequestHeader("Authorization","Basic "+r),n.onreadystatechange=function(){200==n.status?navigate("../errors.html"):console.log("Error: "+n.responseText)},n.send()}else if("logout"==e){if(!(n=createCORSRequest("POST","/proxy/logout")))throw new Error("CORS not supported");n.onreadystatechange=function(){200==n.status?navigate("../login.html"):console.log("Error: "+n.responseText)},n.send()}else if("getErrors"==e){if(!(n=createCORSRequest("GET","/proxy/errors")))throw new Error("CORS not supported");n.onreadystatechange=function(){200==n.status?setErrorList(n.responseText):console.log("Error: "+n.responseText)},n.send()}else if("save_map"==e){if(!(n=createCORSRequest("POST","/proxy/map")))throw new Error("CORS not supported");n.onreadystatechange=function(){200==n.status?(alert("uploaded to server"),mapModified=!1):console.log("Error: "+n.responseText)},n.send(mapFile)}else if("load_map"==e){var n;if(!(n=createCORSRequest("GET","/proxy/map")))throw new Error("CORS not supported");n.send(),n.onreadystatechange=function(){200==n.status?(this.mapFile=String(n.responseText),console.log(n.responseText),console.log(this.mapFile),parseFiles(),updateMap(),mapModified=!1):console.log("Error: "+n.responseText)}}}mapTEST="10,10\n3,0,0,0,0,0,0,0,0,0\n0,2,0,2,0,0,0,0,0,0\n0,0,0,1,0,0,0,0,0,0\n0,0,0,0,0,0,0,0,0,0\n0,0,0,0,0,0,0,0,0,0\n0,0,0,0,0,0,0,0,0,0\n0,0,0,0,0,0,0,0,0,0\n0,0,0,0,0,0,0,0,0,0\n0,0,0,0,0,0,0,0,0,0\n0,0,0,0,0,0,0,0,0,0",window.onload=function(){x=document.getElementById("lowLiquid"),path=document.location.pathname,"localhost"==document.location.hostname&&3e3==document.location.port?"/"==path||"/errors.html"==path?"localhost"==document.location.hostname&&3e3==document.location.port&&setErrorList(15):"/charts.html"==path&&(parseFiles(),updateMap()):"/"==path||"/errors.html"==path?NetworkCall("getErrors"):"/charts.html"==path&&(parseFiles(),updateMap())};